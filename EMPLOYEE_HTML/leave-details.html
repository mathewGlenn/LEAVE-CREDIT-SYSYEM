<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LCMS - Leave Request Details</title>
    <link rel="stylesheet" href="../CSS/leave-details.css">
    <link rel="stylesheet" href="../CSS/sidebar.css">

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>
    
    <!-- Firebase Configuration -->
    <script src="../js/firebase-init.js"></script>
    
    <!-- Leave Details Manager -->
    <script src="../js/leave-details-manager.js"></script>
    
    <!-- Load sidebar script -->
    <script src="../components/sidebar-loader.js"></script>
    <script>
        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            // Load sidebar
            loadSidebar('employee');
            
            // Initialize leave details manager and store globally
            window.leaveDetailsManager = new LeaveDetailsManager();
            window.leaveDetailsManager.initializePage();
        });
    </script>
</head>
<body>
    <div id="sidebar-placeholder"></div>

    <div class="main-content">
        <div class="details-container">
            <div class="details-header">
                <button class="back-button" onclick="history.back()">‚Üê Back</button>
                <div class="details-title">LEAVE REQUEST DETAILS</div>
            </div>

            <div class="request-info" id="requestInfo">
                <div class="loading-message">Loading request details...</div>
            </div>

            <div class="details-form" id="detailsForm" style="display: none;">
                <form id="leaveEditForm">
                    <div class="form-section">
                        <h3>Leave Information</h3>
                        
                        <div class="form-group">
                            <label for="leaveType">Type of Leave:</label>
                            <select id="leaveType" name="leaveType" required>
                                <option value="">Select Leave Type</option>
                                <option value="vacation">Regular Leave</option>
                                <option value="sick">Sick Leave</option>
                                <option value="personal">Special Privilege Leave</option>
                                <option value="emergency">Emergency Leave</option>
                                <option value="maternity">Maternity/Paternity Leave</option>
                                <option value="service">Service Incentive Leave</option>
                            </select>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="startDate">Start Date:</label>
                                <input type="date" id="startDate" name="startDate" required>
                            </div>
                            <div class="form-group">
                                <label for="endDate">End Date:</label>
                                <input type="date" id="endDate" name="endDate" required>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="numberOfDays">Number of Days:</label>
                            <input type="number" id="numberOfDays" name="numberOfDays" readonly>
                        </div>

                        <div class="form-group">
                            <label for="reasonNotes">Reason/Notes:</label>
                            <textarea id="reasonNotes" name="reasonNotes" rows="4" required></textarea>
                        </div>

                        <div class="form-group" id="supportingDocsGroup" style="display: none;">
                            <label for="supportingDocs">Add New Supporting Documents:</label>
                            <div class="file-upload-area">
                                <input type="file" id="supportingDocs" name="supportingDocs" multiple 
                                       accept=".pdf,.doc,.docx,.jpg,.jpeg,.png">
                                <div class="file-upload-text">
                                    <span>Click to choose files or drag and drop</span>
                                    <small>Supported formats: PDF, DOC, DOCX, JPG, PNG</small>
                                </div>
                            </div>
                            <div id="newFiles" class="new-files"></div>
                        </div>
                    </div>

                    <div class="button-group" id="editableButtons" style="display: none;">
                        <button type="button" class="cancel-edit-btn" onclick="cancelEdit()">Cancel Edit</button>
                        <button type="submit" class="save-btn">Save Changes</button>
                    </div>
                </form>

                <!-- Current files section - outside the form to avoid conflicts -->
                <div class="form-section">
                    <h3>Current Supporting Documents</h3>
                    <div id="currentFiles" class="current-files"></div>
                </div>

                <div class="button-group" id="viewButtons">
                    <button type="button" class="edit-btn" onclick="enableEdit()" id="editButton">Edit Request</button>
                    <button type="button" class="cancel-request-btn" onclick="cancelRequest()" id="cancelButton">Cancel Request</button>
                </div>
            </div>

            <div class="approval-section" id="approvalSection">
                <h3>Approval History</h3>
                <div id="approvalHistory"></div>
            </div>
        </div>
    </div>
</body>
</html>
